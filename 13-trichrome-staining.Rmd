# Trichrome staining

Quantification of trichrome staining was performed in Qupath using the following steps:

* image is loaded as a "DAB" image
* using "gold standard" trichrome-stained images with good stroma and epithelial content, estimate the stain vectors
* The output matrix was: XXX
* Perform color deconvolution
* A pixel classifier was used to estimate trichrome content
* A pixel classifier was used to estimate tumor content

A snippet of the qupath script is shown below:

```{r, eval=F, echo=F}
# insert some text here

```

## Associations with cellular fraction (wsi)

```{r, height=6}
# load the data
TrichromeData=read.csv("../data/quantification_trichrome_staining_2020-10-28.csv")
midx=match(TrichromeData$X, gsub("_", "", Cdata$TumorID))

Cdata$Trichrome=NA
Cdata$Trichrome[na.omit(midx)]=TrichromeData$Frac[which(!is.na(midx))]

t2=WSIvalFracs[, match(rownames(df.Spatial), colnames(WSIvalFracs))]

df.Spatial=cbind(df.Spatial, t(t2))

#head(df.Spatial)

df.Spatial$Trichrome=NA
midx=match(TrichromeData$X, rownames(df.Spatial))
df.Spatial$Trichrome[na.omit(midx)]=TrichromeData$Frac[-which(is.na(midx))]
# plot associations

n2=c("CD8", "EpCAM", "SMA", "Unclass", "EpCAM: SMA")

par(mfrow=c(2,3))
for (i in n2){
  a1=cor.test(df.Spatial$Trichrome, df.Spatial[ ,match(i, colnames(df.Spatial))], use="complete")
  n1=paste(i, "cor:", round(a1$estimate,1), "p:", round(a1$p.value,2))
  plot(df.Spatial$Trichrome, df.Spatial[ ,match(i, colnames(df.Spatial))], main=n1, xlab="Trichrome", ylab=i)
}
```

## Associations with growth and spatial patterns

```{r, fig.height=6}
# plot associations with growth
n2=c("GrowthRate", "MH.EpCAM", "IF.EpCAM", "knn.EpCAM")

par(mfrow=c(2,2))
for (i in n2){
  a1=cor.test(df.Spatial$Trichrome, df.Spatial[ ,i], use="complete")
  n1=paste(i, "cor:", round(a1$estimate,1), "p:", round(a1$p.value,2))
  plot(df.Spatial$Trichrome, df.Spatial[ ,i], main=n1, xlab="Trichrome", ylab=i)
}
```